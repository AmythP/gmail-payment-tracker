function recordPaytmPayments() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  // Define your search query to find relevant emails
  var searchQuery = 'from:no-reply@paytm.com subject:"Rs." newer_than:1d'; 
  var threads = GmailApp.search(searchQuery);
  
  // 1. Array to hold all the new data rows
  var dataToRecord = []; 

  for (var i = 0; i < threads.length; i++) {
    var messages = threads[i].getMessages();
    for (var j = 0; j < messages.length; j++) {
      var message = messages[j];
      var subject = message.getSubject();
      var date = message.getDate();
      
      var amountMatch = subject.match(/Rs\. (\d+\.\d{2})/);

      if (amountMatch) {
        var amount = amountMatch[0];
        var formattedDate = date.toLocaleDateString(); 

        // 2. Instead of appending, push the row data to the array
        dataToRecord.push([formattedDate, amount]);

        // Optional: Mark the email as processed to prevent repeats in future runs
        // message.markRead(); // or use labels to move them out of the search results
      }
    }
  }

  // --- Data Overwriting Logic ---

  // Get the last row of data *before* this script runs
  var lastRow = sheet.getLastRow();

  // If there is existing data below the header (Row 1)
  if (lastRow > 1) {
    // 3. Clear the existing data from Row 2 down to the last row
    // Clears the range A2:B[lastRow] (assuming you only use columns A and B)
    sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).clearContent(); 
  }

  // If there is new data to write
  if (dataToRecord.length > 0) {
    // 4. Write all the new data to the sheet starting at Row 2, Column 1
    // The range is Row 2, Column 1, with dataToRecord.length rows and 2 columns
    sheet.getRange(2, 1, dataToRecord.length, 2).setValues(dataToRecord);
  }
}
